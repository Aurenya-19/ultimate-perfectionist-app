<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test System - NEXUS REALITY</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { 
            --bg: #000; 
            --cyan: #00ffff; 
            --pink: #ff00ff; 
            --green: #00ff88; 
            --orange: #ffaa00; 
            --text: #fff;
            --border: rgba(0,255,255,0.3);
        }
        body { font-family: 'Rajdhani', sans-serif; background: var(--bg); color: var(--text); }
        .quantum-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at 20% 50%, rgba(0,255,255,0.1) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(255,0,255,0.1) 0%, transparent 50%); }
        
        .navbar { background: rgba(0,0,0,0.9); padding: 1rem 2rem; border-bottom: 2px solid var(--cyan); position: sticky; top: 0; z-index: 100; }
        .nav-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .logo { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; color: var(--cyan); font-weight: 900; }
        .nav-links { display: flex; gap: 1.5rem; flex-wrap: wrap; }
        .nav-link { color: var(--text); text-decoration: none; transition: all 0.2s; padding: 0.5rem 1rem; border-radius: 5px; }
        .nav-link:hover { color: var(--cyan); background: rgba(0,255,255,0.1); }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .title { font-family: 'Orbitron', sans-serif; font-size: 3rem; font-weight: 900; background: linear-gradient(135deg, var(--cyan), var(--pink), var(--green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; margin-bottom: 1rem; }
        
        .test-setup { background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1)); border: 2px solid var(--cyan); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; }
        .setup-grid { display: grid; gap: 1.5rem; margin-top: 1.5rem; }
        .setup-item { display: flex; flex-direction: column; gap: 0.5rem; }
        .setup-label { color: var(--cyan); font-weight: 700; font-size: 1.1rem; }
        .setup-select, .setup-input { padding: 0.8rem; background: rgba(0,0,0,0.5); border: 2px solid var(--border); border-radius: 8px; color: var(--text); font-size: 1rem; font-family: 'Rajdhani', sans-serif; }
        
        .btn { padding: 1rem 2rem; border: 2px solid var(--cyan); border-radius: 8px; font-weight: 700; cursor: pointer; background: linear-gradient(135deg, var(--cyan), #0099cc); color: #fff; transition: all 0.3s; font-size: 1.1rem; font-family: 'Rajdhani', sans-serif; border: none; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,255,255,0.5); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .test-container { display: none; }
        .test-container.active { display: block; }
        
        .test-header { background: rgba(0,0,0,0.8); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; border: 2px solid var(--cyan); }
        .timer { font-family: 'Orbitron', sans-serif; font-size: 2rem; color: var(--green); font-weight: 900; }
        .timer.warning { color: var(--orange); }
        .timer.danger { color: var(--pink); }
        .progress-info { font-size: 1.1rem; }
        
        .question-card { background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1)); border: 2px solid var(--cyan); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; }
        .question-number { color: var(--pink); font-size: 1.3rem; font-weight: 700; margin-bottom: 1rem; }
        .question-text { font-size: 1.2rem; line-height: 1.8; margin-bottom: 1.5rem; }
        .options { display: grid; gap: 1rem; }
        .option { padding: 1rem; background: rgba(0,0,0,0.3); border: 2px solid var(--border); border-radius: 8px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 1rem; }
        .option:hover { background: rgba(0,255,255,0.1); border-color: var(--cyan); }
        .option.selected { background: rgba(0,255,255,0.2); border-color: var(--cyan); }
        .option input[type="radio"] { width: 20px; height: 20px; cursor: pointer; }
        
        .nav-buttons { display: flex; gap: 1rem; justify-content: space-between; margin-top: 2rem; flex-wrap: wrap; }
        
        .results-container { display: none; }
        .results-container.active { display: block; }
        .results-card { background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1)); border: 2px solid var(--cyan); border-radius: 12px; padding: 3rem; text-align: center; }
        .score-display { font-family: 'Orbitron', sans-serif; font-size: 5rem; color: var(--green); font-weight: 900; margin: 2rem 0; }
        .results-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
        .stat-item { background: rgba(0,0,0,0.5); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border); }
        .stat-value { font-size: 2rem; color: var(--cyan); font-weight: 900; }
        .stat-label { opacity: 0.8; margin-top: 0.5rem; }
        
        .review-section { margin-top: 2rem; text-align: left; }
        .review-item { background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid var(--border); }
        .review-item.correct { border-left-color: var(--green); }
        .review-item.incorrect { border-left-color: var(--pink); }
        
        @media (max-width: 768px) { 
            .title { font-size: 2rem; }
            .score-display { font-size: 3rem; }
        }
    </style>
</head>
<body>
    <div class="quantum-bg"></div>
    
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo">üéØ NEXUS REALITY</div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">üè† Home</a>
                <a href="app.html" class="nav-link">üìö Chapters</a>
                <a href="dashboard.html" class="nav-link">üìä Dashboard</a>
                <a href="test.html" class="nav-link">üìù Tests</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <h1 class="title">üìù Test System</h1>
        
        <!-- Test Setup -->
        <div id="testSetup" class="test-setup">
            <h2 style="color: var(--cyan); font-size: 1.8rem; margin-bottom: 1rem;">Configure Your Test</h2>
            
            <div class="setup-grid">
                <div class="setup-item">
                    <label class="setup-label">Subject</label>
                    <select id="subjectSelect" class="setup-select">
                        <option value="physics">‚öõÔ∏è Physics</option>
                        <option value="chemistry">üß™ Chemistry</option>
                        <option value="maths">üìê Mathematics</option>
                        <option value="mixed">üéØ Mixed (All Subjects)</option>
                    </select>
                </div>
                
                <div class="setup-item">
                    <label class="setup-label">Difficulty</label>
                    <select id="difficultySelect" class="setup-select">
                        <option value="easy">Easy (JEE Main Level)</option>
                        <option value="medium" selected>Medium (JEE Advanced)</option>
                        <option value="hard">Hard (Advanced JEE)</option>
                        <option value="olympiad">Olympiad Level</option>
                        <option value="mixed">Mixed Difficulty</option>
                    </select>
                </div>
                
                <div class="setup-item">
                    <label class="setup-label">Number of Questions</label>
                    <select id="questionCount" class="setup-select">
                        <option value="5">5 Questions (Quick Test)</option>
                        <option value="10" selected>10 Questions</option>
                        <option value="15">15 Questions</option>
                        <option value="20">20 Questions</option>
                        <option value="30">30 Questions (Full Test)</option>
                    </select>
                </div>
                
                <div class="setup-item">
                    <label class="setup-label">Time Limit (minutes)</label>
                    <select id="timeLimit" class="setup-select">
                        <option value="10">10 minutes</option>
                        <option value="15">15 minutes</option>
                        <option value="20" selected>20 minutes</option>
                        <option value="30">30 minutes</option>
                        <option value="45">45 minutes</option>
                        <option value="60">60 minutes</option>
                        <option value="0">No Time Limit</option>
                    </select>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn" onclick="startTest()">
                    <i class="fas fa-play"></i> Start Test
                </button>
            </div>
        </div>
        
        <!-- Test Container -->
        <div id="testContainer" class="test-container">
            <div class="test-header">
                <div class="progress-info">
                    Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span>
                </div>
                <div class="timer" id="timer">20:00</div>
            </div>
            
            <div id="questionContainer"></div>
            
            <div class="nav-buttons">
                <button class="btn" onclick="previousQuestion()" id="prevBtn" style="background: rgba(0,255,255,0.2);">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn" onclick="nextQuestion()" id="nextBtn">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn" onclick="submitTest()" id="submitBtn" style="display: none; background: linear-gradient(135deg, var(--green), #00cc66);">
                    <i class="fas fa-check"></i> Submit Test
                </button>
            </div>
        </div>
        
        <!-- Results Container -->
        <div id="resultsContainer" class="results-container">
            <div class="results-card">
                <h2 style="color: var(--cyan); font-size: 2rem; margin-bottom: 1rem;">Test Completed! üéâ</h2>
                <div class="score-display" id="scoreDisplay">0%</div>
                
                <div class="results-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="correctCount">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectCount">0</div>
                        <div class="stat-label">Incorrect Answers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="unansweredCount">0</div>
                        <div class="stat-label">Unanswered</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="timeTaken">0:00</div>
                        <div class="stat-label">Time Taken</div>
                    </div>
                </div>
                
                <div style="margin-top: 2rem;">
                    <button class="btn" onclick="showReview()" style="margin: 0.5rem;">
                        <i class="fas fa-eye"></i> Review Answers
                    </button>
                    <button class="btn" onclick="resetTest()" style="margin: 0.5rem; background: rgba(0,255,255,0.2);">
                        <i class="fas fa-redo"></i> Take Another Test
                    </button>
                    <a href="dashboard.html" class="btn" style="margin: 0.5rem; display: inline-block; text-decoration: none;">
                        <i class="fas fa-chart-line"></i> View Dashboard
                    </a>
                </div>
                
                <div id="reviewSection" class="review-section" style="display: none;"></div>
            </div>
        </div>
    </div>
    
    <script src="chapters-complete-physics.js"></script>
    <script src="chapters-complete-chemistry.js"></script>
    <script src="chapters-complete-maths.js"></script>
    <script>
        let testQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let timerInterval = null;
        let timeRemaining = 0;
        let startTime = 0;
        
        // Sample question bank (fallback if files don't load)
        const SAMPLE_QUESTIONS = {
            physics: [
                { question: "A body of mass 2 kg is moving with velocity 10 m/s. What is its kinetic energy?", options: ["50 J", "100 J", "200 J", "20 J"], correct: 1, difficulty: "easy" },
                { question: "The SI unit of force is:", options: ["Joule", "Newton", "Watt", "Pascal"], correct: 1, difficulty: "easy" },
                { question: "Acceleration due to gravity on Earth is approximately:", options: ["9.8 m/s¬≤", "10 m/s¬≤", "8.9 m/s¬≤", "11 m/s¬≤"], correct: 0, difficulty: "easy" },
                { question: "Which law states F = ma?", options: ["First law", "Second law", "Third law", "Law of gravitation"], correct: 1, difficulty: "easy" },
                { question: "Power is the rate of doing:", options: ["Force", "Work", "Energy", "Momentum"], correct: 1, difficulty: "easy" }
            ],
            chemistry: [
                { question: "What is the atomic number of Carbon?", options: ["4", "6", "8", "12"], correct: 1, difficulty: "easy" },
                { question: "The pH of pure water is:", options: ["0", "7", "14", "1"], correct: 1, difficulty: "easy" },
                { question: "Which gas is most abundant in Earth's atmosphere?", options: ["Oxygen", "Carbon dioxide", "Nitrogen", "Hydrogen"], correct: 2, difficulty: "easy" },
                { question: "The formula of water is:", options: ["H‚ÇÇO", "HO", "H‚ÇÇO‚ÇÇ", "H‚ÇÉO"], correct: 0, difficulty: "easy" },
                { question: "Avogadro's number is approximately:", options: ["6.022 √ó 10¬≤¬≥", "6.022 √ó 10¬≤¬≤", "6.022 √ó 10¬≤‚Å¥", "6.022 √ó 10¬≤¬π"], correct: 0, difficulty: "easy" }
            ],
            maths: [
                { question: "What is the value of œÄ (pi) approximately?", options: ["3.14", "2.71", "1.41", "1.73"], correct: 0, difficulty: "easy" },
                { question: "The square root of 144 is:", options: ["10", "11", "12", "13"], correct: 2, difficulty: "easy" },
                { question: "What is 15% of 200?", options: ["20", "25", "30", "35"], correct: 2, difficulty: "easy" },
                { question: "The sum of angles in a triangle is:", options: ["90¬∞", "180¬∞", "270¬∞", "360¬∞"], correct: 1, difficulty: "easy" },
                { question: "If x + 5 = 12, what is x?", options: ["5", "6", "7", "8"], correct: 2, difficulty: "easy" }
            ]
        };
        
        function startTest() {
            const subject = document.getElementById('subjectSelect').value;
            const difficulty = document.getElementById('difficultySelect').value;
            const count = parseInt(document.getElementById('questionCount').value);
            const timeLimit = parseInt(document.getElementById('timeLimit').value);
            
            // Generate questions
            testQuestions = generateQuestions(subject, difficulty, count);
            
            if (testQuestions.length === 0) {
                alert('No questions available for this configuration. Please try different settings.');
                return;
            }
            
            // Initialize
            currentQuestionIndex = 0;
            userAnswers = new Array(testQuestions.length).fill(null);
            startTime = Date.now();
            
            // Setup timer
            if (timeLimit > 0) {
                timeRemaining = timeLimit * 60;
                startTimer();
            }
            
            // Show test
            document.getElementById('testSetup').style.display = 'none';
            document.getElementById('testContainer').classList.add('active');
            document.getElementById('totalQuestions').textContent = testQuestions.length;
            
            displayQuestion();
        }
        
        function generateQuestions(subject, difficulty, count) {
            let questions = [];
            
            // Try to get from loaded data
            if (subject === 'physics' && typeof COMPLETE_PHYSICS !== 'undefined') {
                Object.values(COMPLETE_PHYSICS).forEach(chapter => {
                    if (chapter.problems) {
                        chapter.problems.forEach(p => {
                            if (difficulty === 'mixed' || p.difficulty === difficulty) {
                                questions.push(p);
                            }
                        });
                    }
                });
            } else if (subject === 'chemistry' && typeof COMPLETE_CHEMISTRY !== 'undefined') {
                Object.values(COMPLETE_CHEMISTRY).forEach(chapter => {
                    if (chapter.problems) {
                        chapter.problems.forEach(p => {
                            if (difficulty === 'mixed' || p.difficulty === difficulty) {
                                questions.push(p);
                            }
                        });
                    }
                });
            } else if (subject === 'maths' && typeof COMPLETE_MATHS !== 'undefined') {
                Object.values(COMPLETE_MATHS).forEach(chapter => {
                    if (chapter.problems) {
                        chapter.problems.forEach(p => {
                            if (difficulty === 'mixed' || p.difficulty === difficulty) {
                                questions.push(p);
                            }
                        });
                    }
                });
            }
            
            // Fallback to sample questions
            if (questions.length === 0) {
                if (subject === 'mixed') {
                    questions = [...SAMPLE_QUESTIONS.physics, ...SAMPLE_QUESTIONS.chemistry, ...SAMPLE_QUESTIONS.maths];
                } else {
                    questions = SAMPLE_QUESTIONS[subject] || [];
                }
            }
            
            // Shuffle and limit
            questions = questions.sort(() => Math.random() - 0.5).slice(0, count);
            
            return questions;
        }
        
        function displayQuestion() {
            const question = testQuestions[currentQuestionIndex];
            const container = document.getElementById('questionContainer');
            
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            
            let html = `
                <div class="question-card">
                    <div class="question-number">Question ${currentQuestionIndex + 1}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">
            `;
            
            question.options.forEach((option, index) => {
                const isSelected = userAnswers[currentQuestionIndex] === index;
                html += `
                    <label class="option ${isSelected ? 'selected' : ''}" onclick="selectOption(${index})">
                        <input type="radio" name="answer" value="${index}" ${isSelected ? 'checked' : ''}>
                        <span><strong>${String.fromCharCode(65 + index)})</strong> ${option}</span>
                    </label>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Update buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').style.display = currentQuestionIndex === testQuestions.length - 1 ? 'none' : 'block';
            document.getElementById('submitBtn').style.display = currentQuestionIndex === testQuestions.length - 1 ? 'block' : 'none';
        }
        
        function selectOption(index) {
            userAnswers[currentQuestionIndex] = index;
            displayQuestion();
        }
        
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }
        
        function nextQuestion() {
            if (currentQuestionIndex < testQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        }
        
        function startTimer() {
            const timerDisplay = document.getElementById('timer');
            
            timerInterval = setInterval(() => {
                timeRemaining--;
                
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Color warnings
                if (timeRemaining <= 60) {
                    timerDisplay.classList.add('danger');
                } else if (timeRemaining <= 300) {
                    timerDisplay.classList.add('warning');
                }
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    submitTest();
                }
            }, 1000);
        }
        
        function submitTest() {
            if (timerInterval) clearInterval(timerInterval);
            
            // Calculate results
            let correct = 0;
            let incorrect = 0;
            let unanswered = 0;
            
            testQuestions.forEach((q, i) => {
                if (userAnswers[i] === null) {
                    unanswered++;
                } else if (userAnswers[i] === q.correct) {
                    correct++;
                } else {
                    incorrect++;
                }
            });
            
            const score = Math.round((correct / testQuestions.length) * 100);
            const timeTaken = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            
            // Display results
            document.getElementById('testContainer').classList.remove('active');
            document.getElementById('resultsContainer').classList.add('active');
            
            document.getElementById('scoreDisplay').textContent = score + '%';
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = incorrect;
            document.getElementById('unansweredCount').textContent = unanswered;
            document.getElementById('timeTaken').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Save to progress (if available)
            if (window.NEXUS && window.NEXUS.progress) {
                window.NEXUS.progress.addTestScore('test-' + Date.now(), correct, testQuestions.length);
            }
        }
        
        function showReview() {
            const reviewSection = document.getElementById('reviewSection');
            reviewSection.style.display = 'block';
            
            let html = '<h3 style="color: var(--cyan); margin: 2rem 0 1rem;">Answer Review</h3>';
            
            testQuestions.forEach((q, i) => {
                const userAnswer = userAnswers[i];
                const isCorrect = userAnswer === q.correct;
                const className = userAnswer === null ? '' : (isCorrect ? 'correct' : 'incorrect');
                
                html += `
                    <div class="review-item ${className}">
                        <strong style="color: var(--cyan);">Question ${i + 1}:</strong> ${q.question}<br><br>
                        <strong>Your Answer:</strong> ${userAnswer !== null ? q.options[userAnswer] : 'Not answered'}<br>
                        <strong style="color: var(--green);">Correct Answer:</strong> ${q.options[q.correct]}<br>
                        ${isCorrect ? '<span style="color: var(--green);">‚úì Correct!</span>' : '<span style="color: var(--pink);">‚úó Incorrect</span>'}
                    </div>
                `;
            });
            
            reviewSection.innerHTML = html;
        }
        
        function resetTest() {
            document.getElementById('resultsContainer').classList.remove('active');
            document.getElementById('testSetup').style.display = 'block';
            testQuestions = [];
            userAnswers = [];
            currentQuestionIndex = 0;
        }
        
        console.log('üìù Test System - Fully Functional!');
    </script>
</body>
</html>